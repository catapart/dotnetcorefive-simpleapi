<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="description" content="A simple tester app for the simple api functionality that cannot be tested with the OpenAPI visual schema">
    <meta property="og:title" content="API Tester" />
    <meta property="og:url" content="" />
    <meta property="og:description" content="A simple tester app for the simple api functionality that cannot be tested with the OpenAPI visual schema" />
    <link rel="stylesheet" href="main.css">
    <title>API Tester</title>
    <script defer>
        const apiDomain = new URL(window.location).host;

        const socketMessageTypeMap =
            [
                'Unknown', // error checking
                'Greeting', // sending the initial session token and host token
                'Introduction', // for gaining access to channels / providing user data like name/profile pic
                'Heartbeat', // keep-alive signals
                'Properties', // for properties like the participants list or the host id
                'StatusUpdates', // users joined/users left/users are typing/users are asleep/etc
                'Notifications', // relationship added/username tagged/ etc
                'Reaction', // reaction to a message
                'Text', // Text message
                'FormattedText', // Text message that should be handled with special cases
                'Url', // images/videos/audio/media/files anything linked via url
                'ByteArray' // binary data
            ];
        class WebsocketSession {
            constructor() {
                this.domain = new URL(window.location).host;

                this.socket = null;
                this.token = null;
                this.hostToken = null;
                this.peerTokens = {};
                this.offer = null;

                // easy event forwarding
                let node = document.createTextNode(null);
                this.addEventListener = node.addEventListener.bind(node);
                this.removeEventListener = node.removeEventListener.bind(node);
                this.dispatchEvent = node.dispatchEvent.bind(node);
            }

            async host(displayName, iconUrl, handlers) {


                let response = await fetch(`https://${this.domain}/api/websocket/stream`);
                let sessionKey = await response.text();
                console.log("Established new websocket session: ", sessionKey);
                let url = `wss://${this.domain}/video/${sessionKey}`;

                return this.connect(url, displayName, iconUrl, handlers);
            }
            async join(sessionKey, displayName, iconUrl, handlers) {
                let url = `wss://${this.domain}/video/${sessionKey}`;
                return this.connect(url, displayName, iconUrl, handlers);
            }

            async connect(url, displayName, iconUrl, handlers) {

                this.displayName = displayName;
                this.iconUrl = iconUrl || '';

                return new Promise(async (resolve, reject) => {
                    handlers = handlers || {};
                    handlers.onOpen = handlers.onOpen || this.websocket_onOpen.bind(this);
                    handlers.onMessage = handlers.onMessage || this.websocket_onMessage.bind(this);
                    handlers.onClose = handlers.onClose || this.websocket_onClose.bind(this);
                    handlers.onError = handlers.onError || this.websocket_onError.bind(this);
                    try {
                        if (this.socket != null) {
                            this.close();
                        }

                        this.socket = new WebSocket(url);

                        this.socket.onopen = (event) => { resolve(); handlers.onOpen(event); }
                        this.socket.onmessage = handlers.onMessage;
                        this.socket.onclose = handlers.onClose;
                        this.socket.onerror = handlers.onError;

                        window.addEventListener('beforeunload', () => {
                            this.socket.onclose = function () { }; // disable onclose handler first
                            this.socket.close();
                        }, { once: true });

                    }
                    catch (ex) {
                        console.error(ex);
                        reject();
                    }
                })
            }
            async send(message) {
                this.socket.send(message);
            }
            async close() {
                this.socket.close();
            }

            //handlers
            async websocket_onOpen(event) {
                console.log("[Websocket] Connection established");
            }
            async websocket_onMessage(event) {
                console.log(`[Websocket] Data received from server: ${event.data}`);
                let data = JSON.parse(event.data);

                // delegate event to specialized functions
                // dispatch event if it's unrelated to the websocket session (messages/notifications/etc)
                switch (socketMessageTypeMap[data.MessageType]) {
                    case 'Greeting':
                        let greetingValue = JSON.parse(data.Message);
                        console.log(greetingValue);
                        this.initSession(greetingValue);
                        let greetingEvent = new CustomEvent('greeting', { detail: greetingValue });
                        this.dispatchEvent(greetingEvent);
                        break;
                    case 'Introduction':
                        console.error('Client should never receive "Introduction" Message Type.');
                        return;
                    case 'Heartbeat':
                        console.log('[Websocket] Heartbeat received.');
                        // don't usually dispatch heartbeats, but I'm not utilizing them, either.
                        break;
                    case 'Properties':
                        let propertiesValue = JSON.parse(data.Message);
                        console.log(propertiesValue);
                        let propertiesEvent = new CustomEvent('properties', { detail: propertiesValue });
                        this.dispatchEvent(propertiesEvent);
                        break;
                    case 'StatusUpdates':
                        let statusUpdatesValue = JSON.parse(data.Message);
                        console.log(statusUpdatesValue);
                        let connectionUpdates = this.getConnectionUpdates(statusUpdatesValue);
                        if (connectionUpdates.length > 0) {
                            this.updatePeerStatus(connectionUpdates);
                            let peersEvent = new CustomEvent('peers', { detail: connectionUpdates });
                            this.dispatchEvent(peersEvent);
                        }
                        let otherUpdates = statusUpdatesValue.filter((item) => { return (item.Status.toLowerCase().indexOf('connect') == -1); });
                        if (otherUpdates.length > 0) {
                            let statusUpdatesEvent = new CustomEvent('statusupdates', { detail: otherUpdates });
                            this.dispatchEvent(statusUpdatesEvent);
                        }
                        break;
                    case 'Notifications':
                        console.log('[Websocket] Notifications received.');
                        let notificationsEvent = new CustomEvent('notifications', { detail: otherUpdates });
                        this.dispatchEvent(notificationsEvent);
                        break;
                    case 'Reaction':
                        console.log('[Websocket] Reaction received.');
                        let reactionEvent = new CustomEvent('reaction', { detail: data });
                        this.dispatchEvent(reactionEvent);
                        break;
                    case 'Text':
                    case 'FormattedText':
                    case 'Url':
                    case 'ByteArray':
                        console.log('[Websocket] Message received.');
                        let messageEvent = new CustomEvent('message', { detail: data });
                        this.dispatchEvent(messageEvent);
                        break;
                    case 'Unknown':
                    default:
                        console.error("[Websocket] Unknown Message Type: " + data.MessageType);
                        return;
                }
            }
            async websocket_onClose(event) {

                if (event.wasClean) {
                    console.log(`[Websocket] Connection closed cleanly, code=${event.code} reason=${event.reason}`);
                } else {
                    // e.g. server process killed or network down
                    // event.code is usually 1006 in this case
                    console.log('[Websocket] Connection died');
                }
                this.socket = null;
                let messageEvent = new CustomEvent('close');
                this.dispatchEvent(messageEvent);
            }
            async websocket_onError(event) {

                console.error(`[Websocket] ${error.message}`);
            }


            //functionality
            initSession(greeting) {

                this.token = greeting.Token;
                this.hostToken = greeting.HostToken;

                this.updatePeers(greeting.Peers);

                this.makeIntroduction();

            }
            makeIntroduction() {

                let displayName = this.displayName || this.token.SocketId;
                this.token.DisplayName = displayName;
                this.token.IconUrl = '';

                console.log("Sending Introduction: ", this.token);
                let message = JSON.stringify(this.token);
                this.socket.send(JSON.stringify({ Type: 2, SenderId: this.token, Message: message }));
            }

            getConnectionUpdates(statusUpdates) {
                let connectionUpdates = [];
                for (let i = 0; i < statusUpdates.length; i++) {
                    let statusUpdate = statusUpdates[i];
                    if (statusUpdate.Status == 'connect') {
                        connectionUpdates.push(statusUpdate);
                    }
                    else if (statusUpdate.Status == 'disconnect') {
                        connectionUpdates.push(statusUpdate);
                    }
                }

                return connectionUpdates;
            }

            updatePeerStatus(updates) {
                for (let i = 0; i < updates.length; i++) {
                    let update = updates[i];
                    if (update.Status == 'disconnect') {
                        this.removePeers(update.Peers);
                        continue;
                    }
                    this.updatePeers(update.Peers);
                }
            }
            updatePeers(peers) {
                if (peers == null) {
                    return;
                }
                for (let i = 0; i < peers.length; i++) {
                    let peer = peers[i];
                    this.updatePeer(peer);
                }
            }
            updatePeer(peer) {
                this.peerTokens[peer.SocketId] = peer;
            }
            removePeers(peers) {
                if (peers == null) {
                    return;
                }
                for (let i = 0; i < peers.length; i++) {
                    let peer = peers[i];
                    this.removePeer(peer);
                }
            }
            removePeer(peer) {
                delete this.peerTokens[peer.SocketId];
            }
        }
    </script>
</head>

<body>
    <main>
        <header class="full-width">
            <div class="inset">
                <div>
                    <h1><img class="icon logo" src="" />API Tester</h1>
                    <h2 class="version"></h2>
                </div>
                <h3>This page is for testing non-REST functionality, including file streaming, websocket, and WebRTC sessions.</h3>
                <h3>For testing any standard REST endpoints, please use the OpenAPI route (this can be set as the default in launchsettings.json)</h3>
            </div>
        </header>

        <div class="content full-width">
            <script defer type="module">

                document.addEventListener('DOMContentLoaded', Init);

                async function Init() {
                    // establish a well-known variable
                    // to hold the websocket session
                    var chatSession = null;

                    // define well-known html elements
                    const $chatroom = document.querySelector('.card.chat .chatroom');
                    $chatroom.$title = $chatroom.querySelector('header > .title');

                    const $sessionKeyCopier = $chatroom.querySelector('.session-key-copier');
                    $sessionKeyCopier.$value = $sessionKeyCopier.querySelector('.value');
                    $sessionKeyCopier.$copyButton = $sessionKeyCopier.querySelector('button.copy');

                    const $peers = $chatroom.querySelector('.peers');
                    $peers.$firstPeer = $peers.querySelector('.first-peer');
                    $peers.$modifiedCount = $peers.querySelector('.modified-count');
                    $peers.$chatPeers = $peers.querySelector('dl');

                    const $chatMessages = document.getElementById('chat-messages');
                    $chatMessages.$noSession = $chatMessages.querySelector('.no-session');

                    const $textChatMessageForm = document.getElementById('text-chat-message');
                    $textChatMessageForm.$value = $textChatMessageForm.querySelector('input');
                    $textChatMessageForm.$submit = $textChatMessageForm.querySelector('.submit');

                    const $chatSetup = document.querySelector('.card.chat .setup');

                    const $textHostDisplayName = $chatSetup.querySelector('.choice.host .display-name');
                    const $textHostButton = $chatSetup.querySelector('.choice.host .action');
                    const $textEndButton = $chatSetup.querySelector('.choice.host .exit');
                    const $textHostErrorMessage = $chatSetup.querySelector('.choice.host .message');

                    const $textGuestSessionKey = $chatSetup.querySelector('.display.join .session-key');
                    const $textGuestDisplayName = $chatSetup.querySelector('.choice.join .display-name');
                    const $textJoinButton = $chatSetup.querySelector('.choice.join .action');
                    const $textLeaveButton = $chatSetup.querySelector('.choice.join .exit');
                    const $textJoinErrorMessage = $chatSetup.querySelector('.choice.join .message');

                    // add functionality
                    $sessionKeyCopier.$copyButton.addEventListener('click', textCopyButton_onClick);
                    $textHostButton.addEventListener('click', textHostChat_onClick);
                    $textEndButton.addEventListener('click', textEndChat_onClick);
                    $textJoinButton.addEventListener('click', textJoinChat_onClick);
                    $textLeaveButton.addEventListener('click', textLeaveChat_onClick);
                    $textChatMessageForm.addEventListener('submit', textChatMessageForm_onSubmit);

                    resetChat();

                    // handlers
                    function textCopyButton_onClick(event) {
                        if (chatSession == null) {
                            console.error('Cannot copy session key from session that has not been started.');
                            return;
                        }
                        $sessionKeyCopier.$value.select();
                        $sessionKeyCopier.$value.setSelectionRange(0, 99999);
                        document.execCommand('copy');
                        addChatStatus('Copied the Session Key');
                    }
                    async function textHostChat_onClick(event) {
                        if (chatSession != null) {
                            console.error('Session is already active. End the session before starting a new one.');
                            return;
                        }

                        resetChat();

                        chatSession = createChatSession();
                        await chatSession.host($textHostDisplayName.value);

                        $textHostButton.setAttribute('disabled', 'disabled');
                        $textEndButton.removeAttribute('disabled');
                        $textJoinButton.setAttribute('disabled', 'disabled');
                        $textLeaveButton.setAttribute('disabled', 'disabled');

                        $chatroom.classList.add('in-session');
                    }
                    async function textEndChat_onClick(event) {
                        if (chatSession == null) {
                            return;
                        }
                        chatSession.ending = true;
                        await chatSession.close();

                        $textHostButton.removeAttribute('disabled');
                        $textJoinButton.removeAttribute('disabled');
                        $textLeaveButton.setAttribute('disabled', 'disabled');
                        $textEndButton.setAttribute('disabled', 'disabled');
                    }

                    async function textJoinChat_onClick(event) {
                        if (chatSession != null) {
                            console.error('Session is already active. End the session before starting a new one.');
                            return;
                        }

                        resetChat();

                        chatSession = createChatSession();
                        await chatSession.join($textGuestSessionKey.value, $textGuestDisplayName.value);

                        $textJoinButton.setAttribute('disabled', 'disabled');
                        $textLeaveButton.removeAttribute('disabled');
                        $textHostButton.setAttribute('disabled', 'disabled');
                        $textEndButton.setAttribute('disabled', 'disabled');

                        $chatroom.classList.add('in-session');
                    }
                    async function textLeaveChat_onClick(event) {
                        if (chatSession == null) {
                            return;
                        }
                        chatSession.ending = true;
                        await chatSession.close();

                        $textHostButton.removeAttribute('disabled');
                        $textJoinButton.removeAttribute('disabled');
                        $textLeaveButton.setAttribute('disabled', 'disabled');
                        $textEndButton.setAttribute('disabled', 'disabled');
                    }

                    async function textChatMessageForm_onSubmit(event) {
                        event.preventDefault();
                        event.stopPropagation();

                        if (chatSession == null) {
                            console.error("No session has been started.");
                            return false;
                        }

                        console.log("Sending to server");
                        addChatMessage({ SenderId: chatSession.token.SocketId, Message: $textChatMessageForm.$value.value });
                        chatSession.send(JSON.stringify({ Message: $textChatMessageForm.$value.value }));

                        $textChatMessageForm.$value.value = '';
                        return false;
                    }

                    function chatSession_OnGreeting(event) {
                        setSessionState(true);
                        $sessionKeyCopier.$value.value = event.detail.SessionKey;

                        let introMessage = '';
                        let hostName = (chatSession.hostToken.DisplayName || 'Host');
                        if (chatSession.token == chatSession.hostToken) {
                            introMessage = hostName + " has started a text chat session.";
                        }
                        else {
                            introMessage = `You have joined ${hostName}'s chat.`;
                        }
                        $chatroom.$title.textContent = hostName + '\'s text chat';
                        chatSession.peerTokens[chatSession.token.SocketId] = Object.assign({}, chatSession.token);
                        clearChatHistory();
                        updateChatPeers();
                        $sessionKeyCopier.$copyButton.removeAttribute('disabled');

                        addChatStatus(introMessage);
                    }
                    function chatSession_OnPeers(event) {
                        updateChatPeers();

                        // show messages
                        let updates = event.detail;
                        for (let i = 0; i < updates.length; i++) {
                            let update = updates[i];
                            for (let j = 0; j < update.Peers.length; j++) {
                                let peer = update.Peers[j];
                                let displayName = (peer.DisplayName == '') ? `[${peer.SocketId}]` : peer.DisplayName;
                                let isHost = peer.SocketId == chatSession.hostToken.SocketId;
                                if (update.Status == 'connect' && isHost == false) {
                                    let content = `<div>${displayName} has joined the chat.</div>`;
                                    let $joinMessage = addChatStatus(content);
                                }
                                else if (update.Status == 'disconnect') {
                                    let action = (isHost == true) ? 'ended' : 'left';
                                    let content = `<div>${displayName} has ${action} the chat.</div>`;
                                    let $leaveMessage = addChatStatus(content);
                                }
                            }
                        }
                    }
                    function chatSession_OnMessage(event) {
                        addChatMessage(event.detail);
                    }
                    function chatSession_OnClose(event) {
                        if (chatSession.ending == true) {
                            let action = (chatSession.token.SocketId == chatSession.hostToken.SocketId) ? 'ended' : 'left';
                            addChatStatus(`[You have ${action} the chat session.]`);
                            setSessionState(false);
                        }
                        else {
                            addChatStatus('[The chat session has been ended.]');
                            setSessionState(false);
                        }
                        chatSession = null;
                    }

                    // functionality
                    function resetChat() {
                        setSessionState(false);
                        clearChatHistory();
                    }

                    function setSessionState(inSession) {
                        if (inSession == true) {
                            $chatroom.classList.add('in-session');
                            $sessionKeyCopier.$copyButton.removeAttribute('disabled');
                            $textChatMessageForm.$submit.removeAttribute('disabled');
                        }
                        else {
                            $chatroom.classList.remove('in-session');
                            $chatroom.$title.textContent = '';
                            clearChatParticipants();
                            $textHostErrorMessage.textContent = '';
                            $textJoinErrorMessage.textContent = '';
                            $sessionKeyCopier.$value.value = '';
                            $sessionKeyCopier.$copyButton.setAttribute('disabled', 'disabled');
                            $textChatMessageForm.$submit.setAttribute('disabled', 'disabled');
                        }
                    }

                    function createChatSession() {
                        let session = new WebsocketSession();
                        session.addEventListener('greeting', chatSession_OnGreeting);
                        session.addEventListener('peers', chatSession_OnPeers);
                        session.addEventListener('message', chatSession_OnMessage);
                        session.addEventListener('close', chatSession_OnClose);
                        return session;
                    }

                    function clearChatHistory() {
                        while ($chatMessages.lastChild) {
                            $chatMessages.lastChild.remove();
                        }

                        if (chatSession == null) {
                            $chatMessages.appendChild($chatMessages.$noSession);
                        }
                    }
                    function clearChatParticipants() {
                        while ($peers.$chatPeers.lastChild) {
                            $peers.$chatPeers.lastChild.remove();
                        }

                        $peers.classList.remove('others');
                        $peers.$firstPeer.textContent = '';
                        $peers.$modifiedCount.textContent = '';
                    }
                    function updateChatPeers() {
                        clearChatParticipants();

                        for (let property in chatSession.peerTokens) {

                            let peer = chatSession.peerTokens[property];
                            let displayName = (peer.DisplayName == '') ? `[${peer.SocketId}]` : peer.DisplayName;
                            let $peer = document.createElement('dt');
                            $peer.classList.add('peer');
                            if (peer == chatSession.hostToken) {
                                $peer.classList.add('host');
                            }
                            if (peer == chatSession.token) {
                                $peer.classList.add('self');
                            }
                            $peer.textContent = displayName;
                            $peers.$chatPeers.appendChild($peer);
                        }

                        let hostName = (chatSession.hostToken.DisplayName || 'Host');
                        $peers.$firstPeer.textContent = hostName;
                        $peers.$modifiedCount.textContent = chatSession.peerTokens.length;
                        if (chatSession.peerTokens.length > 1) {
                            $peers.classList.add('others');
                        }
                    }
                    function addChatStatus(statusMessage) {
                        let $message = document.createElement('li');
                        $message.classList.add('status');
                        $message.innerHTML = statusMessage;

                        $chatMessages.appendChild($message);
                        return $message;
                    }
                    function addChatMessage(messageData) {
                        let $message = document.createElement('li');
                        $message.classList.add('message');

                        let content;
                        if (Object.prototype.toString.call(messageData) === '[object String]') {
                            content = `${messageData}`;
                        }
                        else {
                            let peer = (messageData.SenderId == chatSession.token.SocketId) ? chatSession.token : chatSession.peerTokens[messageData.SenderId];
                            if (peer == null) {
                                console.error('Unknown Participant. Socket ID: ' + messageData.SenderId);
                                return;
                            }
                            let currentDate = new Date();
                            let date = (((currentDate.getMonth() + 1) < 10) ? '0' + (currentDate.getMonth() + 1) : (currentDate.getMonth() + 1)) + '/' + ((currentDate.getDate() < 10) ? '0' + currentDate.getDate() : currentDate.getDate()) + '/' + currentDate.getFullYear();
                            let meridian = 'am';
                            let hours = currentDate.getHours();
                            if (hours > 12) {
                                meridian = 'pm';
                                hours = currentDate.getHours() - 12;
                            }
                            let time = (hours < 10 ? '0' + hours : hours) + ':' + currentDate.getMinutes() + ' ' + meridian;
                            let userContent = '';
                            if (peer != chatSession.token) {
                                userContent = `<span class="user">
                                                <span class="image-container">
                                                    ${peer.IconUrl || `<svg class="icon user" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 2c2.757 0 5 2.243 5 5.001 0 2.756-2.243 5-5 5s-5-2.244-5-5c0-2.758 2.243-5.001 5-5.001zm0-2c-3.866 0-7 3.134-7 7.001 0 3.865 3.134 7 7 7s7-3.135 7-7c0-3.867-3.134-7.001-7-7.001zm6.369 13.353c-.497.498-1.057.931-1.658 1.302 2.872 1.874 4.378 5.083 4.972 7.346h-19.387c.572-2.29 2.058-5.503 4.973-7.358-.603-.374-1.162-.811-1.658-1.312-4.258 3.072-5.611 8.506-5.611 10.669h24c0-2.142-1.44-7.557-5.631-10.647z" /></svg>`}
                                                </span>
                                                <span class="name">${peer.DisplayName || 'Unknown Guest'}</span>
                                            </span>
                                            `;
                            }
                            else {
                                $message.classList.add('self');
                            }

                            content = `${userContent}<div class="body">
                                        <div class="content">
                                            ${messageData.Message}
                                        </div>
                                        <footer>
                                            <span class="date">${date}</span>
                                            <span class="time">${time}</span>
                                        </footer>
                                    </div>`;
                        }

                        $message.innerHTML = content;

                        $chatMessages.appendChild($message);

                        $chatMessages.scrollTop = $chatMessages.scrollHeight - $chatMessages.getBoundingClientRect().height;
                        return $message;
                    }
                }
            </script>
            <div class="card chat">
                <header>
                    <h4>Text Chat</h4>
                </header>
                <div class="content">
                    <div class="chatroom">
                        <header>
                            <div class="title">Host's Chatroom</div>
                            <span class="session-key-copier">
                                <small class="description">Session Key</small>
                                <input class="value" type="text" value="xxxxxx" />
                                <button class="copy" type="button" title="Copy Session Key" disabled>
                                    <svg class="icon" width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd"><path d="M20 24h-20v-22h3c1.229 0 2.18-1.084 3-2h8c.82.916 1.771 2 3 2h3v9h-2v-7h-4l-2 2h-3.898l-2.102-2h-4v18h16v-5h2v7zm-10-4h-6v-1h6v1zm0-2h-6v-1h6v1zm6-5h8v2h-8v3l-5-4 5-4v3zm-6 3h-6v-1h6v1zm0-2h-6v-1h6v1zm0-2h-6v-1h6v1zm0-2h-6v-1h6v1zm-1-7c0 .552.448 1 1 1s1-.448 1-1-.448-1-1-1-1 .448-1 1z" /></svg>
                                    <span class="label">Copy</span>
                                </button>
                            </span>
                        </header>
                        <details class="peers">
                            <summary><span class="first-peer">Host</span><span class="description">and <span class="modified-count">1</span> others...</span></summary>
                            <dl>
                                <dt>Host</dt>
                                <dt>Test User</dt>
                            </dl>
                        </details>
                        <div class="display">
                            <ul id="chat-messages">
                                <li class="no-session">No session has been started.</li>
                                <li class="status">Test User has joined the chat</li>
                                <li class="message self">
                                    <div class="body">
                                        <div class="content">
                                            Hola Mundo!
                                        </div>
                                        <footer>
                                            <span class="time">10:31</span>
                                            <span class="month">1</span>/
                                            <span class="day">1</span>/
                                            <span class="year">2021</span>
                                        </footer>
                                    </div>
                                <li class="message">
                                    <span class="user">
                                        <span class="image-container">
                                            <svg class="icon user" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 2c2.757 0 5 2.243 5 5.001 0 2.756-2.243 5-5 5s-5-2.244-5-5c0-2.758 2.243-5.001 5-5.001zm0-2c-3.866 0-7 3.134-7 7.001 0 3.865 3.134 7 7 7s7-3.135 7-7c0-3.867-3.134-7.001-7-7.001zm6.369 13.353c-.497.498-1.057.931-1.658 1.302 2.872 1.874 4.378 5.083 4.972 7.346h-19.387c.572-2.29 2.058-5.503 4.973-7.358-.603-.374-1.162-.811-1.658-1.312-4.258 3.072-5.611 8.506-5.611 10.669h24c0-2.142-1.44-7.557-5.631-10.647z" /></svg>
                                        </span>
                                        <span class="name">Test User</span>
                                    </span>
                                    <div class="body">
                                        <header>
                                        </header>
                                        <div class="content">
                                            Hi! I hope this message finds you well!
                                        </div>
                                        <footer>
                                            <span class="time">10:33</span>
                                            <span class="month">1</span>/
                                            <span class="day">1</span>/
                                            <span class="year">2021</span>
                                        </footer>
                                    </div>
                                </li>
                            </ul>
                            <aside>
                                <div class="peers">
                                </div>
                                <!--<div class="messages-container">
                            <ul id="video-chat-messages"></ul>
                        </div>-->
                            </aside>
                        </div>
                        <form id="text-chat-message">
                            <input class="value" name="message" type="text" placeholder="Send a message..." autocomplete="off" />
                            <button class="submit" type="submit" title="Send message">
                                <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M24 0l-6 22-8.129-7.239 7.802-8.234-10.458 7.227-7.215-1.754 24-12zm-15 16.668v7.332l3.258-4.431-3.258-2.901z" /></svg>
                                <span class="label">Send</span>
                            </button>
                        </form>
                    </div>
                    <div class="setup">
                        <span class="display host">
                            <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M3.449 15.19c-.92-1.513-1.449-3.289-1.449-5.189 0-5.523 4.477-10.001 10-10.001s10 4.478 10 10.001c0 1.9-.529 3.676-1.451 5.189.513-1.156.797-2.434.797-3.78 0-5.163-4.184-9.347-9.346-9.347s-9.346 4.185-9.346 9.347c0 1.345.284 2.624.795 3.78zm3.108-3.78c0-3.006 2.438-5.442 5.443-5.442s5.443 2.437 5.443 5.443c0 .696-.133 1.362-.371 1.975.648-.969 1.025-2.132 1.025-3.384 0-3.368-2.73-6.099-6.098-6.099s-6.098 2.73-6.098 6.099c0 1.252.377 2.416 1.025 3.384-.237-.613-.369-1.279-.369-1.976zm6.443 2.59c1.162-.414 2-1.512 2-2.816 0-1.657-1.344-3-3-3s-3 1.343-3 3c0 1.304.838 2.403 2 2.816l-5 10h2.236c.713-1.426 2.17-2.326 3.764-2.326s3.051.9 3.764 2.326h2.236l-5-10zm-2.764 6l1.764-3.528 1.764 3.528h-3.528z" /></svg>
                            <span class="description">Host</span>
                        </span>
                        <span class="display join">
                            <svg class="icon" width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill-rule="evenodd" clip-rule="evenodd"><path d="M20 15c0 .552-.448 1-1 1s-1-.448-1-1 .448-1 1-1 1 .448 1 1m-3 0c0 .552-.448 1-1 1s-1-.448-1-1 .448-1 1-1 1 .448 1 1m-3 0c0 .552-.448 1-1 1s-1-.448-1-1 .448-1 1-1 1 .448 1 1m5.415 4.946c-1 .256-1.989.482-3.324.482-3.465 0-7.091-2.065-7.091-5.423 0-3.128 3.14-5.672 7-5.672 3.844 0 7 2.542 7 5.672 0 1.591-.646 2.527-1.481 3.527l.839 2.686-2.943-1.272zm-13.373-3.375l-4.389 1.896 1.256-4.012c-1.121-1.341-1.909-2.665-1.909-4.699 0-4.277 4.262-7.756 9.5-7.756 5.018 0 9.128 3.194 9.467 7.222-1.19-.566-2.551-.889-3.967-.889-4.199 0-8 2.797-8 6.672 0 .712.147 1.4.411 2.049-.953-.126-1.546-.272-2.369-.483m17.958-1.566c0-2.172-1.199-4.015-3.002-5.21l.002-.039c0-5.086-4.988-8.756-10.5-8.756-5.546 0-10.5 3.698-10.5 8.756 0 1.794.646 3.556 1.791 4.922l-1.744 5.572 6.078-2.625c.982.253 1.932.407 2.85.489 1.317 1.953 3.876 3.314 7.116 3.314 1.019 0 2.105-.135 3.242-.428l4.631 2-1.328-4.245c.871-1.042 1.364-2.384 1.364-3.75" /></svg>
                            <span class="description">Join</span>
                            <small class="label">Session Key</small>
                            <input class="session-key" type="text" placeholder="xxxxx" title="Session Key" />
                        </span>
                        <span class="choice host">
                            <span class="control">
                                <small class="label">Display Name</small>
                                <input class="display-name" type="text" title="Display Name" value="Host" />
                                <button class="action" type="button">Host Chat</button>
                                <button class="exit" type="button" disabled>End Chat</button>
                            </span>
                            <span class="message">This is an error</span>
                        </span>
                        <span class="choice join">
                            <span class="control">
                                <small class="label">Display Name</small>
                                <input class="display-name" type="text" title="Display Name" value="Guest" />
                                <button class="action" type="button">Join Chat</button>
                                <button class="exit" type="button" disabled>Leave</button>
                            </span>
                            <span class="message">This is a really long error that should wrap to the next line and still be legible in all circumstances</span>
                        </span>
                    </div>
                </div>
                <footer>
                    <div class="message"></div>
                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M13.5 8c.276 0 .5.224.5.5v7c0 .276-.224.5-.5.5h-11c-.276 0-.5-.224-.5-.5v-7c0-.276.224-.5.5-.5h11zm2.5 0c0-1.104-.896-2-2-2h-12c-1.104 0-2 .896-2 2v8c0 1.104.896 2 2 2h12c1.104 0 2-.896 2-2v-8zm6 1.854v4.293l-2-1.408v-1.478l2-1.407zm2-3.854l-6 4.223v3.554l6 4.223v-12z" /></svg>
                </footer>
            </div>

            <div class="card file-upload">
                <header>
                    <h3>File Upload</h3>
                </header>
                <div class="content">
                    <form id="get-data-item">
                        <label is="form-field" title="Data Store:" name="datastore">
                            <select>
                                <option value="api">API</option>
                                <option value="indexeddb">IndexedDB</option>
                                <option value="localstorage">LocalStorage</option>
                            </select>
                        </label>
                        <label is="form-field" title="Data Item ID:" name="data-item-id" value="-1">
                            <select><option value="-1">&lt;Select a Data Store&gt;</option></select>
                            <svg class="icon spinner" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M13.75 22c0 .966-.783 1.75-1.75 1.75s-1.75-.784-1.75-1.75.783-1.75 1.75-1.75 1.75.784 1.75 1.75zm-1.75-22c-1.104 0-2 .896-2 2s.896 2 2 2 2-.896 2-2-.896-2-2-2zm10 10.75c.689 0 1.249.561 1.249 1.25 0 .69-.56 1.25-1.249 1.25-.69 0-1.249-.559-1.249-1.25 0-.689.559-1.25 1.249-1.25zm-22 1.25c0 1.105.896 2 2 2s2-.895 2-2c0-1.104-.896-2-2-2s-2 .896-2 2zm19-8c.551 0 1 .449 1 1 0 .553-.449 1.002-1 1-.551 0-1-.447-1-.998 0-.553.449-1.002 1-1.002zm0 13.5c.828 0 1.5.672 1.5 1.5s-.672 1.501-1.502 1.5c-.826 0-1.498-.671-1.498-1.499 0-.829.672-1.501 1.5-1.501zm-14-14.5c1.104 0 2 .896 2 2s-.896 2-2.001 2c-1.103 0-1.999-.895-1.999-2s.896-2 2-2zm0 14c1.104 0 2 .896 2 2s-.896 2-2.001 2c-1.103 0-1.999-.895-1.999-2s.896-2 2-2z" /></svg>
                        </label>
                        <label is="form-field" title="Data:" name="data"><textarea></textarea></label>
                    </form>
                </div>
                <footer>
                    <div class="message"></div>
                    <ul class="actions">
                        <li><button class="action" type="submit" form="get-data-item">Get Data</button></li>
                    </ul>
                </footer>
            </div>

            <div class="card video-chat">
                <header>
                    <h4>Video Chat</h4>
                </header>
                <div class="content">
                    <form id="video-chat">
                        <label is="form-field" title="Data Store:" name="datastore">
                            <select>
                                <option value="api">API</option>
                                <option value="indexeddb">IndexedDB</option>
                                <option value="localstorage">LocalStorage</option>
                            </select>
                        </label>
                        <label is="form-field" title="Data:" name="data" value="Hola Mundo!"><textarea></textarea></label>
                        <label is="form-field" type="text" title="Data Item ID:" name="data-item-id" placeholder="Save a data item to display that item's ID here."></label>
                    </form>
                </div>
                <footer>
                    <div class="message"></div>
                    <ul class="actions">
                        <li><button class="action" type="submit" form="save-data-item">Save Data</button></li>
                    </ul>
                </footer>
            </div>

        </div>
        <footer class="full-width">

        </footer>

    </main>
    <!-- Anything out here shouldn't be visible by default -->

    <!-- These are modal windows. They can be used for simple messages... -->
    <modal-window type="message">
        <span slot="title">Message</span>
        <div slot="content">
            <h3>Here is some content</h3>
            <p>Along with a paragraph of some non-information. Isn't that nice?</p>
        </div>
    </modal-window>
    <!-- Or to prompt the user with a question -->
    <!-- These custom elements use slots. Whereas the others are too simple or too specialized to work with them well, modal content makes great use of slots. -->
    <modal-window class="choices">
        <span slot="title">Dialog</span>
        <div slot="content">
            <h3>This should present the user with a choice.</h3>
            <p>Do you want to proceed?</p>
        </div>
        <ul slot="choices">
            <li><button class="cancel" type="button">Cancel</button></li>
            <li><button class="ok" type="button">Ok</button></li>
        </ul>
    </modal-window>
    
    <!-- This is a toast message. It's another way to give the user feedback in the UI that may be better suited for certain use cases. -->
    <!-- css properties are a great way to handle some styling control within custom elements -->
    <toast-message style="--background-color: #7d6fcd; --color: #e4d6f5; --close-color: #fff; --title-color: #fff;"></toast-message>

    <!-- These are the templates that are used to make the custom elements. -->
    <template id="app-health">
        <style scoped>
            app-health dl { margin-left: 6px; }
            app-health dt { font-weight: bold; color: #217ac0; font-size: 110% }
            app-health dt { font-family: Consolas, "Liberation Mono", Courier }
            app-health dd { margin-left: 16px }

            @keyframes rotating { 100% { transform: rotate(360deg); } }
            app-health .spinner { animation: rotating 1.2s infinite linear; }

            app-health .waiting path, .spinner path { fill:#0075ff; }
            app-health .pass path { fill: rgb(83, 146, 83); }
            app-health .fail path { fill: rgb(201, 93, 93); }

            app-health .status { display: none; }
            app-health dl .status { display: initial; }
        </style>
        <header>
            <h3>App Health</h3>
            <span class="description">A simple test suite that checks component functionality.</span>
        </header>
        <dl class="tests"><dt><h5>Tests</h5><span class="icon"></span></dt></dl>
        <svg class="icon status waiting" title="Waiting icon" alt="waiting-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M13 23c0-.552-.448-1-1-1s-1 .448-1 1 .448 1 1 1 1-.448 1-1zm4.209-.834c0-.552-.448-1-1-1s-1 .448-1 1 .448 1 1 1 1-.448 1-1zm3.568-2.387c0-.552-.448-1-1-1s-1 .448-1 1 .448 1 1 1 1-.447 1-1zm2.385-3.568c0-.552-.448-1-1-1s-1 .448-1 1 .448 1 1 1 1-.448 1-1zm.838-4.209c0-.552-.448-1-1-1s-1 .448-1 1 .448 1 1 1 1-.447 1-1zm-.838-4.209c0-.552-.448-1-1-1s-1 .448-1 1 .448 1 1 1 1-.447 1-1zm-2.385-3.568c0-.552-.448-1-1-1s-1 .448-1 1 .448 1 1 1 1-.448 1-1zm-3.567-2.385c0-.552-.448-1-1-1s-1 .448-1 1 .448 1 1 1 1-.448 1-1zm-4.21-.84c0-.552-.448-1-1-1s-1 .448-1 1 .448 1 1 1 1-.448 1-1zm-4.21.838c0-.552-.448-1-1-1s-1 .448-1 1 .448 1 1 1 1-.448 1-1zm-3.569 2.385c0-.552-.448-1-1-1s-1 .448-1 1 .448 1 1 1 1-.448 1-1zm-2.384 3.57c0-.552-.448-1-1-1s-1 .448-1 1 .448 1 1 1 1-.447 1-1zm-.837 4.209c0-.552-.448-1-1-1s-1 .448-1 1 .448 1 1 1 1-.448 1-1zm.837 4.209c0-.552-.448-1-1-1s-1 .448-1 1 .448 1 1 1 1-.447 1-1zm2.384 3.569c0-.552-.448-1-1-1s-1 .448-1 1 .448 1 1 1 1-.447 1-1zm3.571 2.383c0-.552-.448-1-1-1s-1 .448-1 1 .448 1 1 1 1-.448 1-1z"/></svg>
        <svg class="icon status spinner" title="Spinner icon" alt="spinner-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M13.75 22c0 .966-.783 1.75-1.75 1.75s-1.75-.784-1.75-1.75.783-1.75 1.75-1.75 1.75.784 1.75 1.75zm-1.75-22c-1.104 0-2 .896-2 2s.896 2 2 2 2-.896 2-2-.896-2-2-2zm10 10.75c.689 0 1.249.561 1.249 1.25 0 .69-.56 1.25-1.249 1.25-.69 0-1.249-.559-1.249-1.25 0-.689.559-1.25 1.249-1.25zm-22 1.25c0 1.105.896 2 2 2s2-.895 2-2c0-1.104-.896-2-2-2s-2 .896-2 2zm19-8c.551 0 1 .449 1 1 0 .553-.449 1.002-1 1-.551 0-1-.447-1-.998 0-.553.449-1.002 1-1.002zm0 13.5c.828 0 1.5.672 1.5 1.5s-.672 1.501-1.502 1.5c-.826 0-1.498-.671-1.498-1.499 0-.829.672-1.501 1.5-1.501zm-14-14.5c1.104 0 2 .896 2 2s-.896 2-2.001 2c-1.103 0-1.999-.895-1.999-2s.896-2 2-2zm0 14c1.104 0 2 .896 2 2s-.896 2-2.001 2c-1.103 0-1.999-.895-1.999-2s.896-2 2-2z"/></svg>
        <svg class="icon status pass" title="Pass icon" alt="pass-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-1.25 16.518l-4.5-4.319 1.396-1.435 3.078 2.937 6.105-6.218 1.421 1.409-7.5 7.626z"/></svg>
        <svg class="icon status fail" title="Fail icon" alt="fail-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M16.971 0h-9.942l-7.029 7.029v9.941l7.029 7.03h9.941l7.03-7.029v-9.942l-7.029-7.029zm-4.971 19.25c-.69 0-1.25-.56-1.25-1.25s.56-1.25 1.25-1.25 1.25.56 1.25 1.25-.56 1.25-1.25 1.25zm.5-4.25h-1l-1-10h3l-1 10z"/></svg>
    </template>

    <template id="form-field">
        <style>
            @keyframes rotating { 100% { transform: rotate(360deg); } }
            [is="form-field"] .spinner { animation: rotating 1.2s infinite linear; display:none; }
            [is="form-field"].loading .spinner
            ,[is="form-field"] .spinner.show
            ,[is="form-field"][loading] .spinner
            { display: initial; }
        </style>
        <span class="title"></span>
        <span class="delimiter"></span>
        <span class="content"></span>
    </template>

    <template id="modal-window">
        <style>
            .shade { position:fixed; top:-1px; left:-1px; right: -1px; bottom: -1px; z-index: 100; background-color: rgba(0,0,0,.5); }
            modal-window { display: none; }
            modal-window.open { display: flex; flex-direction: column; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index:101; width: 70%; }

        </style>
        <header>
            <span class="information">
                <slot name="icon"></slot>
                <slot name="title"></slot>
            </span>
            <slot name="controls"><button class="control close" type="button" title="Close modal">&times;</button></slot>
        </header>
        <slot name="content"></slot>
        <footer>
            <slot name="choices"><ul class="choices"></ul></slot>
        </footer>
    </template>

    <template id="file-uploader">
        <style>
            .js file-uploader .value {
                width: 0.1px;
                height: 0.1px;
                opacity: 0;
                overflow: hidden;
                position: absolute;
                z-index: -1;
            }

            file-uploader .value + label {
                max-width: 80%;
                font-size: 1.25rem;
                /* 20px */
                font-weight: 700;
                text-overflow: ellipsis;
                white-space: nowrap;
                cursor: pointer;
                display: inline-block;
                overflow: hidden;
                padding: 0.625rem 1.25rem;
                /* 10px 20px */
            }

            .no-js file-uploader .value + label {
                display: none;
            }

            file-uploader .value:focus + label,
            file-uploader .value.has-focus + label {
                outline: 1px dotted #000;
                outline: -webkit-focus-ring-color auto 5px;
            }

            file-uploader .value + label *
            {
                /* pointer-events: none; */
                /* in case of FastClick lib use */
            }

            file-uploader .value + label svg {
                width: 1em;
                height: 1em;
                vertical-align: middle;
                fill: currentColor;
                margin-top: -0.25em;
                /* 4px */
                margin-right: 0.25em;
                /* 4px */
            }

            file-uploader .value + label {
                color: #d3394c;
            }

            file-uploader .value:focus + label,
            file-uploader .value.has-focus + label,
            file-uploader .value + label:hover {
                color: #722040;
            }

            file-uploader .value + label figure {
                width: 100px;
                height: 135px;
                background-color: #d3394c;
                display: block;
                position: relative;
                padding: 30px;
                margin: 0 auto 10px;
            }

            file-uploader .value:focus + label figure,
            file-uploader .value.has-focus + label figure,
            file-uploader .value + label:hover figure {
                background-color: #722040;
            }

            file-uploader .value + label figure::before,
            file-uploader .value + label figure::after {
                width: 0;
                height: 0;
                content: '';
                position: absolute;
                top: 0;
                right: 0;
            }

            file-uploader .value + label figure::before {
                border-top: 20px solid #dfc8ca;
                border-left: 20px solid transparent;
            }

            file-uploader .value + label figure::after {
                border-bottom: 20px solid #722040;
                border-right: 20px solid transparent;
            }

            file-uploader .value:focus + label figure::after,
            file-uploader .value.has-focus + label figure::after,
            file-uploader .value + label:hover figure::after {
                border-bottom-color: #d3394c;
            }

            file-uploader .value + label svg
            {
                width: 100%;
                height: 100%;
                fill: #f1e5e6;
            }
        </style>
        <form enctype="multipart/form-data" method="post">
            <div class="field-group">
                <input type="file" name="uploadfile" class="value" data-multiple-caption="{count} files selected" multiple />
                <label>
                    <figure>
                        <svg class="icon file-upload" xmlns="http://www.w3.org/2000/svg" width="20" height="17" viewBox="0 0 20 17"><path d="M10 0l-5.2 4.9h3.3v5.1h3.8v-5.1h3.3l-5.2-4.9zm9.3 11.5l-3.2-2.1h-2l3.4 2.6h-3.5c-.1 0-.2.1-.2.1l-.8 2.3h-6l-.8-2.2c-.1-.1-.1-.2-.2-.2h-3.6l3.4-2.6h-2l-3.2 2.1c-.4.3-.7 1-.6 1.5l.6 3.1c.1.5.7.9 1.2.9h16.3c.6 0 1.1-.4 1.3-.9l.6-3.1c.1-.5-.2-1.2-.7-1.5z"></path></svg>
                    </figure>
                    <span>Choose files…</span>
                </label>
            </div>
            <button type="submit">Upload</button>
        </form>
    </template>
</body>

</html>